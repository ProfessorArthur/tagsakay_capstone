name = "tagsakay-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Environment variables (add these via Wrangler CLI or dashboard)
# wrangler secret put DATABASE_URL
# wrangler secret put JWT_SECRET

[env.production]
name = "tagsakay-api-production"
# Custom domain is now live (configured Nov 5, 2025)
routes = [
  { pattern = "api.tagsakay.com/*", custom_domain = true }
]

# Note: Durable Objects require paid plan. WebSocket logic will use alternative approach.
# [[env.production.durable_objects.bindings]]
# name = "DEVICE_CONNECTIONS"
# class_name = "DeviceConnection"
# script_name = "tagsakay-api-production"

# [[env.production.migrations]]
# tag = "v1"
# new_classes = ["DeviceConnection"]

[env.development]
name = "tagsakay-api-development"
# Development uses .dev.vars and runs locally on port 8787

# Durable Objects for WebSocket connections (development only)
[[env.development.durable_objects.bindings]]
name = "DEVICE_CONNECTIONS"
class_name = "DeviceConnection"
script_name = "tagsakay-api-development"

[[env.development.migrations]]
tag = "v1"
new_classes = ["DeviceConnection"]

[env.staging]
name = "tagsakay-api-staging"
# Staging environment configuration
